<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✨ Gallery ✨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body {
            background: #ffffff;
            height: 100vh;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            cursor: none;
            user-select: none;
        }

        /* CURSOR */
        .cursor {
            width: 20px; height: 20px;
            border: 2px solid rgba(0,0,0,0.25);
            border-radius: 50%; position: fixed;
            pointer-events: none; z-index: 10000;
            transition: width 0.3s ease, height 0.3s ease, background 0.3s ease, border-color 0.3s ease, border-style 0.2s ease;
            transform: translate(-50%, -50%);
            mix-blend-mode: difference;
        }
        .cursor.hover { width: 55px; height: 55px; background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.5); }
        .cursor.grab { width: 40px; height: 40px; background: rgba(0,0,0,0.08); border-color: rgba(0,0,0,0.6); border-style: dashed; }
        .cursor.arrow-left, .cursor.arrow-right { width: 60px; height: 60px; background: rgba(0,0,0,0.03); border-color: rgba(0,0,0,0.4); }
        .cursor-dot {
            width: 5px; height: 5px; background: #000; border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 10001; transform: translate(-50%, -50%);
        }
        .trail {
            position: fixed; width: 3px; height: 3px;
            background: rgba(0,0,0,0.06); border-radius: 50%;
            pointer-events: none; z-index: 9999;
            animation: trailFade 0.6s ease forwards;
        }
        @keyframes trailFade { to { opacity: 0; transform: scale(0); } }

        /* LOADER */
        .loader {
            position: fixed; inset: 0; background: #fff;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999;
            transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
        }
        .loader.hidden { opacity: 0; transform: scale(1.03); pointer-events: none; }
        .loader-title {
            font-family: 'Playfair Display', serif; font-size: 1.6rem;
            letter-spacing: 14px; text-transform: uppercase; color: #000;
            margin-bottom: 50px; opacity: 0; animation: fadeUp 1s ease forwards 0.2s;
        }
        .loader-bar-wrap {
            width: 180px; height: 1px; background: rgba(0,0,0,0.08);
            overflow: hidden; opacity: 0; animation: fadeUp 1s ease forwards 0.5s;
        }
        .loader-bar { height: 100%; background: #000; width: 0%; transition: width 0.2s ease; }
        .loader-pct {
            font-size: 0.6rem; color: rgba(0,0,0,0.25); letter-spacing: 5px;
            margin-top: 18px; opacity: 0; animation: fadeUp 1s ease forwards 0.7s;
        }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

        /* MAIN STAGE */
        .stage {
            position: fixed; inset: 0;
            display: flex; align-items: center; justify-content: center;
            perspective: 1200px;
            opacity: 0; transition: opacity 1s ease;
        }
        .stage.visible { opacity: 1; }

        /* 3D IMAGE CANVAS */
        .canvas3d {
            position: relative;
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            transform-style: preserve-3d;
        }

        .slide {
            position: absolute;
            max-width: 75vw; max-height: 80vh;
            transition: transform 0.8s var(--ease-out-expo), opacity 0.8s ease, filter 0.8s ease;
            transform-style: preserve-3d;
            will-change: transform, opacity;
            border-radius: 8px;
            overflow: visible;
        }

        .slide.active {
            opacity: 1; z-index: 10;
            filter: none;
        }
        .slide.prev {
            opacity: 0; z-index: 5;
            filter: blur(2px) brightness(0.97);
            pointer-events: none;
        }
        .slide.next {
            opacity: 0; z-index: 5;
            filter: blur(2px) brightness(0.97);
            pointer-events: none;
        }
        .slide.far {
            opacity: 0; z-index: 1;
            pointer-events: none;
        }

        .slide-inner {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0,0,0,0.08), 0 8px 30px rgba(0,0,0,0.04);
            transition: box-shadow 0.5s ease;
            transform-style: preserve-3d;
        }

        .slide.active .slide-inner {
            box-shadow: 0 30px 100px rgba(0,0,0,0.1), 0 10px 40px rgba(0,0,0,0.06);
        }

        .slide-inner img {
            display: block;
            max-width: 75vw; max-height: 80vh;
            border-radius: 8px;
            pointer-events: none;
            transition: transform 0.6s var(--ease-out-expo), filter 0.5s ease;
            filter: saturate(1.03) contrast(1.01);
        }

        .slide-inner .shine {
            position: absolute; inset: 0;
            background: linear-gradient(105deg, transparent 40%, rgba(255,255,255,0.1) 45%,
                rgba(255,255,255,0.22) 50%, rgba(255,255,255,0.1) 55%, transparent 60%);
            pointer-events: none; z-index: 2;
            transform: translateX(-120%);
            transition: none;
        }

        .slide.active:hover .slide-inner .shine {
            animation: shineGo 1.4s ease forwards;
        }
        @keyframes shineGo { to { transform: translateX(120%); } }

        .slide-inner .overlay-gradient {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 40%; pointer-events: none; z-index: 1;
            background: linear-gradient(to top, rgba(0,0,0,0.03), transparent);
            border-radius: 0 0 8px 8px;
        }

        /* REFLECTION UNDER IMAGE */
        .slide-reflection {
            position: absolute;
            bottom: -6px; left: 5%; right: 5%;
            height: 50px;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.04), transparent 70%);
            filter: blur(12px);
            z-index: -1;
            transform: translateZ(-1px);
            transition: opacity 0.5s ease;
        }

        /* NAV ARROWS (edge zones) */
        .nav-zone {
            position: fixed; top: 0; width: 15%; height: 100%;
            z-index: 50; display: flex; align-items: center;
            cursor: none;
        }
        .nav-zone.left { left: 0; justify-content: flex-start; padding-left: 30px; }
        .nav-zone.right { right: 0; justify-content: flex-end; padding-right: 30px; }

        .nav-arrow {
            width: 50px; height: 50px;
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; color: rgba(0,0,0,0.2);
            transition: all 0.4s var(--ease-out-expo);
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.6);
            opacity: 0; transform: scale(0.8);
        }
        .nav-zone:hover .nav-arrow {
            opacity: 1; transform: scale(1);
        }
        .nav-zone:active .nav-arrow {
            transform: scale(0.9);
            background: rgba(0,0,0,0.03);
        }

        /* BOTTOM BAR */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 80px; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            gap: 30px;
            background: linear-gradient(to top, rgba(255,255,255,0.95), rgba(255,255,255,0));
            opacity: 0; transform: translateY(10px);
            transition: opacity 0.8s ease 0.3s, transform 0.8s var(--ease-out-expo) 0.3s;
        }
        .bottom-bar.visible { opacity: 1; transform: translateY(0); }

        /* Dots */
        .dots {
            display: flex; gap: 10px; align-items: center;
        }
        .dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: rgba(0,0,0,0.1);
            transition: all 0.4s var(--ease-out-expo);
            cursor: none;
        }
        .dot.active {
            width: 24px; border-radius: 3px;
            background: rgba(0,0,0,0.3);
        }
        .dot:hover { background: rgba(0,0,0,0.25); }

        /* Counter */
        .counter {
            font-size: 0.55rem; letter-spacing: 4px;
            color: rgba(0,0,0,0.18); text-transform: uppercase;
            min-width: 70px; text-align: center;
        }

        /* Top bar */
        .top-bar {
            position: fixed; top: 0; left: 0; right: 0;
            height: 70px; z-index: 100;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.95), rgba(255,255,255,0));
            opacity: 0; transform: translateY(-10px);
            transition: opacity 0.8s ease 0.3s, transform 0.8s var(--ease-out-expo) 0.3s;
        }
        .top-bar.visible { opacity: 1; transform: translateY(0); }

        .brand {
            font-family: 'Playfair Display', serif;
            font-size: 0.75rem; letter-spacing: 6px;
            color: rgba(0,0,0,0.1);
        }

        .image-title {
            font-family: 'Playfair Display', serif;
            font-size: 0.7rem; letter-spacing: 3px; font-style: italic;
            color: rgba(0,0,0,0.15);
            transition: opacity 0.4s ease;
        }

        .keys-hint {
            font-size: 0.45rem; letter-spacing: 3px;
            color: rgba(0,0,0,0.1); text-transform: uppercase;
        }

        /* Zoom HUD */
        .zoom-hud {
            position: fixed; bottom: 90px; left: 50%;
            transform: translateX(-50%) translateY(15px);
            display: flex; align-items: center; gap: 12px;
            background: rgba(255,255,255,0.92); backdrop-filter: blur(20px);
            border: 1px solid rgba(0,0,0,0.05); border-radius: 40px;
            padding: 8px 20px; z-index: 100;
            opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s var(--ease-out-expo);
            box-shadow: 0 4px 25px rgba(0,0,0,0.03);
        }
        .zoom-hud.visible { opacity: 1; pointer-events: all; transform: translateX(-50%) translateY(0); }

        .zoom-hud button {
            background: none; border: 1px solid rgba(0,0,0,0.08);
            width: 28px; height: 28px; border-radius: 50%;
            font-size: 14px; color: rgba(0,0,0,0.35); cursor: none;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease;
        }
        .zoom-hud button:hover { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.15); color: rgba(0,0,0,0.6); }
        .zoom-hud button:active { transform: scale(0.88); }
        .zoom-pct { font-size: 0.55rem; letter-spacing: 2px; color: rgba(0,0,0,0.25); min-width: 40px; text-align: center; }
        .zoom-hud .sep { width: 1px; height: 14px; background: rgba(0,0,0,0.05); }
        .zoom-hud .rbtn { width: auto; padding: 0 12px; border-radius: 16px; font-size: 0.45rem; letter-spacing: 2px; text-transform: uppercase; }

        /* Thumbnail strip */
        .thumb-strip {
            position: fixed; bottom: 85px; left: 50%;
            transform: translateX(-50%);
            display: flex; gap: 8px; align-items: center;
            z-index: 99;
            opacity: 0; transition: opacity 0.5s ease 0.5s;
        }
        .thumb-strip.visible { opacity: 1; }
        .thumb {
            width: 44px; height: 32px; border-radius: 4px; overflow: hidden;
            border: 2px solid transparent;
            transition: all 0.3s var(--ease-out-expo);
            opacity: 0.4; cursor: none;
            flex-shrink: 0;
        }
        .thumb.active { border-color: rgba(0,0,0,0.2); opacity: 1; transform: scale(1.1); }
        .thumb:hover { opacity: 0.8; transform: scale(1.05); }
        .thumb img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

        /* Floating particles */
        .particle {
            position: fixed; width: 2px; height: 2px;
            background: rgba(0,0,0,0.03); border-radius: 50%;
            pointer-events: none; z-index: 0;
        }

        /* Ambient corners */
        .amb { position: fixed; width: 100px; height: 100px; pointer-events: none; z-index: 0; opacity: 0.25; }
        .amb.tl { top: 25px; left: 25px; border-top: 1px solid rgba(0,0,0,0.03); border-left: 1px solid rgba(0,0,0,0.03); }
        .amb.tr { top: 25px; right: 25px; border-top: 1px solid rgba(0,0,0,0.03); border-right: 1px solid rgba(0,0,0,0.03); }
        .amb.bl { bottom: 25px; left: 25px; border-bottom: 1px solid rgba(0,0,0,0.03); border-left: 1px solid rgba(0,0,0,0.03); }
        .amb.br { bottom: 25px; right: 25px; border-bottom: 1px solid rgba(0,0,0,0.03); border-right: 1px solid rgba(0,0,0,0.03); }

        /* Transition overlay for slide changes */
        .transition-flash {
            position: fixed; inset: 0; background: rgba(255,255,255,0.4);
            pointer-events: none; z-index: 200; opacity: 0;
            transition: opacity 0.15s ease;
        }
        .transition-flash.flash { opacity: 1; }

        @keyframes float {
            0%,100% { transform: translate(0,0); }
            33% { transform: translate(8px,-12px); }
            66% { transform: translate(-6px,-20px); }
        }
        @keyframes pulse {
            0%,100% { opacity: 0.03; }
            50% { opacity: 0.06; }
        }

        @media (max-width: 768px) {
            body { cursor: auto; }
            .cursor, .cursor-dot { display: none !important; }
            .nav-zone { width: 20%; }
            .nav-arrow { width: 36px; height: 36px; font-size: 14px; }
            .slide-inner img { max-width: 90vw; max-height: 70vh; }
            .slide { max-width: 90vw; max-height: 70vh; }
            .top-bar { padding: 0 20px; }
            .keys-hint { display: none; }
            .amb { display: none; }
            .thumb { width: 36px; height: 26px; }
        }
    </style>
</head>
<body>

    <div class="cursor" id="cursor"></div>
    <div class="cursor-dot" id="cursorDot"></div>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-title">Gallery</div>
        <div class="loader-bar-wrap"><div class="loader-bar" id="loaderBar"></div></div>
        <div class="loader-pct" id="loaderPct">0%</div>
    </div>

    <div class="transition-flash" id="flash"></div>

    <!-- Ambient -->
    <div class="amb tl"></div><div class="amb tr"></div><div class="amb bl"></div><div class="amb br"></div>

    <!-- Top Bar -->
    <div class="top-bar" id="topBar">
        <div class="brand">G A L L E R Y</div>
        <div class="image-title" id="imageTitle"></div>
        <div class="keys-hint">← → &nbsp;or&nbsp; scroll</div>
    </div>

    <!-- Stage -->
    <div class="stage" id="stage">
        <div class="canvas3d" id="canvas3d"></div>
    </div>

    <!-- Nav zones -->
    <div class="nav-zone left" id="navLeft"><div class="nav-arrow">←</div></div>
    <div class="nav-zone right" id="navRight"><div class="nav-arrow">→</div></div>

    <!-- Bottom bar -->
    <div class="bottom-bar" id="bottomBar">
        <div class="counter" id="counter">1 / 9</div>
        <div class="dots" id="dots"></div>
    </div>

    <!-- Thumb strip -->
    <div class="thumb-strip" id="thumbStrip"></div>

    <!-- Zoom HUD -->
    <div class="zoom-hud" id="zoomHud">
        <button id="zOutBtn">−</button>
        <div class="zoom-pct" id="zoomPct">100%</div>
        <button id="zInBtn">+</button>
        <div class="sep"></div>
        <button class="rbtn" id="zResetBtn">Reset</button>
    </div>

    <script>
    const IMAGES = [
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/bullyingpeopletype.png', title: 'Bullying People Type' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/anthony1.jpg', title: 'Anthony — I' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/anthony2.jpg', title: 'Anthony — II' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/anthony3.jpg', title: 'Anthony — III' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/saintlaurenceconfessions.jpg', title: 'Saint Laurence Confessions — I' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/saintlaurenceconfessions2.jpg', title: 'Saint Laurence Confessions — II' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/saintlaurenceconfessions3.jpg', title: 'Saint Laurence Confessions — III' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/saintlaurenceconfessions4.jpg', title: 'Saint Laurence Confessions — IV' },
        { src: 'https://raw.githubusercontent.com/corrodedfridge-tech/heh/main/saintlaurenceconfessions5.jpg', title: 'Saint Laurence Confessions — V' },
    ];

    let current = 0;
    let imgScale = 1, panX = 0, panY = 0;
    let dragging = false, dragSX, dragSY, panSX, panSY;
    let tiltX = 0, tiltY = 0;
    const MIN_S = 0.5, MAX_S = 8;

    const cursorEl = document.getElementById('cursor');
    const cursorDotEl = document.getElementById('cursorDot');
    const canvas3d = document.getElementById('canvas3d');
    const stage = document.getElementById('stage');
    const flash = document.getElementById('flash');
    const topBar = document.getElementById('topBar');
    const bottomBar = document.getElementById('bottomBar');
    const thumbStrip = document.getElementById('thumbStrip');
    const dotsEl = document.getElementById('dots');
    const counterEl = document.getElementById('counter');
    const titleEl = document.getElementById('imageTitle');
    const zoomHud = document.getElementById('zoomHud');
    const zoomPct = document.getElementById('zoomPct');

    let mouseX = 0, mouseY = 0, cX = 0, cY = 0;

    // ===== CURSOR =====
    document.addEventListener('mousemove', e => {
        mouseX = e.clientX; mouseY = e.clientY;
        cursorDotEl.style.left = mouseX + 'px';
        cursorDotEl.style.top = mouseY + 'px';
        if (Math.random() > 0.82) {
            const t = document.createElement('div');
            t.className = 'trail';
            t.style.left = (mouseX + (Math.random()-.5)*8) + 'px';
            t.style.top = (mouseY + (Math.random()-.5)*8) + 'px';
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 600);
        }
    });
    (function aCur() {
        cX += (mouseX - cX) * 0.14;
        cY += (mouseY - cY) * 0.14;
        cursorEl.style.left = cX + 'px';
        cursorEl.style.top = cY + 'px';
        requestAnimationFrame(aCur);
    })();

    function setHover(el) {
        el.addEventListener('mouseenter', () => cursorEl.classList.add('hover'));
        el.addEventListener('mouseleave', () => cursorEl.classList.remove('hover'));
    }

    // ===== LOADER =====
    const loaderEl = document.getElementById('loader');
    const loaderBar = document.getElementById('loaderBar');
    const loaderPct = document.getElementById('loaderPct');

    let loadProg = 0, loadedCount = 0;

    IMAGES.forEach(img => {
        const i = new Image();
        i.onload = i.onerror = () => { loadedCount++; };
        i.src = img.src;
    });

    setTimeout(() => {
        const iv = setInterval(() => {
            const done = loadedCount >= IMAGES.length;
            loadProg += done ? Math.random() * 14 + 5 : Math.random() * 2.5 + 0.8;
            if (loadProg >= 100) {
                loadProg = 100; clearInterval(iv);
                loaderBar.style.width = '100%';
                loaderPct.textContent = '100%';
                setTimeout(() => {
                    loaderEl.classList.add('hidden');
                    setTimeout(initApp, 500);
                }, 600);
                return;
            }
            loaderBar.style.width = Math.floor(loadProg) + '%';
            loaderPct.textContent = Math.floor(loadProg) + '%';
        }, 45);
    }, 500);

    // ===== INIT =====
    function initApp() {
        buildSlides();
        buildDots();
        buildThumbs();
        spawnParticles();
        goTo(0, false);
        stage.classList.add('visible');
        topBar.classList.add('visible');
        bottomBar.classList.add('visible');
        thumbStrip.classList.add('visible');
        bindEvents();
    }

    // ===== BUILD SLIDES =====
    function buildSlides() {
        IMAGES.forEach((img, i) => {
            const slide = document.createElement('div');
            slide.className = 'slide far';
            slide.dataset.index = i;
            slide.innerHTML = `
                <div class="slide-inner">
                    <img src="${img.src}" alt="${img.title}" draggable="false">
                    <div class="shine"></div>
                    <div class="overlay-gradient"></div>
                </div>
                <div class="slide-reflection"></div>
            `;
            canvas3d.appendChild(slide);
        });
    }

    function buildDots() {
        IMAGES.forEach((_, i) => {
            const d = document.createElement('div');
            d.className = 'dot';
            d.addEventListener('click', () => goTo(i));
            setHover(d);
            dotsEl.appendChild(d);
        });
    }

    function buildThumbs() {
        IMAGES.forEach((img, i) => {
            const t = document.createElement('div');
            t.className = 'thumb';
            t.innerHTML = `<img src="${img.src}" alt="">`;
            t.addEventListener('click', () => goTo(i));
            setHover(t);
            thumbStrip.appendChild(t);
        });
    }

    // ===== GO TO SLIDE =====
    function goTo(index, animate = true) {
        if (index < 0) index = IMAGES.length - 1;
        if (index >= IMAGES.length) index = 0;

        // Flash
        if (animate && index !== current) {
            flash.classList.add('flash');
            setTimeout(() => flash.classList.remove('flash'), 150);
        }

        current = index;

        // Reset zoom/pan
        imgScale = 1; panX = 0; panY = 0;
        updateZoomTransform(false);

        const slides = canvas3d.querySelectorAll('.slide');
        slides.forEach((s, i) => {
            s.classList.remove('active', 'prev', 'next', 'far');
            const diff = i - current;
            if (diff === 0) {
                s.classList.add('active');
                s.style.transform = `translateX(0) translateZ(0) rotateY(0)`;
            } else if (diff === -1 || (current === 0 && i === IMAGES.length - 1)) {
                s.classList.add('prev');
                s.style.transform = `translateX(-110%) translateZ(-200px) rotateY(25deg)`;
            } else if (diff === 1 || (current === IMAGES.length - 1 && i === 0)) {
                s.classList.add('next');
                s.style.transform = `translateX(110%) translateZ(-200px) rotateY(-25deg)`;
            } else {
                s.classList.add('far');
                s.style.transform = `translateX(${diff > 0 ? 200 : -200}%) translateZ(-500px) scale(0.5)`;
            }
        });

        // Update dots
        dotsEl.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === current));

        // Update thumbs
        thumbStrip.querySelectorAll('.thumb').forEach((t, i) => t.classList.toggle('active', i === current));

        // Counter & title
        counterEl.textContent = `${current + 1} / ${IMAGES.length}`;
        titleEl.textContent = IMAGES[current].title;

        // Hide zoom HUD on reset
        zoomHud.classList.remove('visible');
    }

    // ===== 3D TILT =====
    function handleTilt(e) {
        if (dragging || imgScale > 1.05) return;
        const slide = canvas3d.querySelector('.slide.active');
        if (!slide) return;

        const rect = slide.getBoundingClientRect();
        const inBounds = e.clientX >= rect.left && e.clientX <= rect.right &&
                         e.clientY >= rect.top && e.clientY <= rect.bottom;

        if (inBounds) {
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            tiltX = (y - 0.5) * -12;
            tiltY = (x - 0.5) * 12;
        } else {
            tiltX *= 0.92;
            tiltY *= 0.92;
        }

        const inner = slide.querySelector('.slide-inner');
        inner.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale(${imgScale}) translate(${panX}px, ${panY}px)`;
        inner.style.transition = 'transform 0.1s ease';
    }

    function resetTilt() {
        const slide = canvas3d.querySelector('.slide.active');
        if (!slide || imgScale > 1.05) return;
        tiltX = 0; tiltY = 0;
        const inner = slide.querySelector('.slide-inner');
        inner.style.transform = `rotateX(0) rotateY(0) scale(1) translate(0,0)`;
        inner.style.transition = 'transform 0.6s var(--ease-out-expo)';
    }

    // ===== ZOOM & PAN =====
    function updateZoomTransform(animate = true) {
        const slide = canvas3d.querySelector('.slide.active');
        if (!slide) return;
        const inner = slide.querySelector('.slide-inner');

        if (imgScale > 1.05) {
            inner.style.transform = `rotateX(0) rotateY(0) scale(${imgScale}) translate(${panX / imgScale}px, ${panY / imgScale}px)`;
            inner.style.transition = animate ? 'transform 0.35s var(--ease-out-expo)' : 'none';
            zoomHud.classList.add('visible');
        } else {
            inner.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale(1) translate(0,0)`;
            inner.style.transition = animate ? 'transform 0.5s var(--ease-out-expo)' : 'none';
            zoomHud.classList.remove('visible');
            panX = 0; panY = 0;
        }
        zoomPct.textContent = Math.round(imgScale * 100) + '%';
    }

    function clampPan() {
        if (imgScale <= 1) { panX = 0; panY = 0; return; }
        const slide = canvas3d.querySelector('.slide.active');
        if (!slide) return;
        const inner = slide.querySelector('.slide-inner');
        const img = inner.querySelector('img');
        const r = img.getBoundingClientRect();
        const maxX = Math.max(0, (r.width * imgScale - window.innerWidth) / 2 / imgScale * 0.8);
        const maxY = Math.max(0, (r.height * imgScale - window.innerHeight) / 2 / imgScale * 0.8);
        panX = Math.max(-maxX, Math.min(maxX, panX));
        panY = Math.max(-maxY, Math.min(maxY, panY));
    }

    // ===== EVENTS =====
    function bindEvents() {
        const navLeft = document.getElementById('navLeft');
        const navRight = document.getElementById('navRight');

        navLeft.addEventListener('click', () => { if (imgScale <= 1.05) goTo(current - 1); });
        navRight.addEventListener('click', () => { if (imgScale <= 1.05) goTo(current + 1); });
        setHover(navLeft); setHover(navRight);

        navLeft.addEventListener('mouseenter', () => cursorEl.classList.add('arrow-left'));
        navLeft.addEventListener('mouseleave', () => cursorEl.classList.remove('arrow-left'));
        navRight.addEventListener('mouseenter', () => cursorEl.classList.add('arrow-right'));
        navRight.addEventListener('mouseleave', () => cursorEl.classList.remove('arrow-right'));

        // Keyboard
        document.addEventListener('keydown', e => {
            if (e.code === 'ArrowLeft' && imgScale <= 1.05) { e.preventDefault(); goTo(current - 1); }
            if (e.code === 'ArrowRight' && imgScale <= 1.05) { e.preventDefault(); goTo(current + 1); }
            if (e.code === 'ArrowLeft' && imgScale > 1.05) { e.preventDefault(); panX += 80; clampPan(); updateZoomTransform(); }
            if (e.code === 'ArrowRight' && imgScale > 1.05) { e.preventDefault(); panX -= 80; clampPan(); updateZoomTransform(); }
            if (e.code === 'ArrowUp' && imgScale > 1.05) { e.preventDefault(); panY += 80; clampPan(); updateZoomTransform(); }
            if (e.code === 'ArrowDown' && imgScale > 1.05) { e.preventDefault(); panY -= 80; clampPan(); updateZoomTransform(); }
            if (e.code === 'Equal' || e.code === 'NumpadAdd') { e.preventDefault(); imgScale = Math.min(MAX_S, imgScale * 1.35); clampPan(); updateZoomTransform(); }
            if (e.code === 'Minus' || e.code === 'NumpadSubtract') { e.preventDefault(); imgScale = Math.max(MIN_S, imgScale / 1.35); clampPan(); updateZoomTransform(); }
            if (e.code === 'Escape' || e.code === 'Digit0') { imgScale = 1; panX = 0; panY = 0; updateZoomTransform(); }
        });

        // Mouse move for tilt
        document.addEventListener('mousemove', e => {
            if (!dragging) handleTilt(e);
        });

        // Wheel: zoom if over image, slide if not
        document.addEventListener('wheel', e => {
            const slide = canvas3d.querySelector('.slide.active');
            if (!slide) return;
            const rect = slide.getBoundingClientRect();
            const over = e.clientX >= rect.left && e.clientX <= rect.right &&
                         e.clientY >= rect.top && e.clientY <= rect.bottom;

            if (over || imgScale > 1.05) {
                e.preventDefault();
                const d = -e.deltaY * 0.002;
                const ns = Math.max(MIN_S, Math.min(MAX_S, imgScale * (1 + d)));

                if (imgScale <= 1.05 && ns <= 1.05) {
                    // Navigate
                    if (e.deltaY > 30) goTo(current + 1);
                    else if (e.deltaY < -30) goTo(current - 1);
                    return;
                }

                const inner = slide.querySelector('.slide-inner');
                const ir = inner.getBoundingClientRect();
                const ox = e.clientX - ir.left - ir.width / 2;
                const oy = e.clientY - ir.top - ir.height / 2;
                const f = ns / imgScale;
                panX = ox - f * (ox - panX);
                panY = oy - f * (oy - panY);
                imgScale = ns;
                clampPan();
                updateZoomTransform(false);
            } else {
                if (e.deltaY > 20) goTo(current + 1);
                else if (e.deltaY < -20) goTo(current - 1);
            }
        }, { passive: false });

        // Drag to pan
        canvas3d.addEventListener('mousedown', e => {
            if (e.button !== 0) return;
            if (imgScale <= 1.05) return;
            dragging = true;
            dragSX = e.clientX; dragSY = e.clientY;
            panSX = panX; panSY = panY;
            cursorEl.classList.add('grab');
        });
        document.addEventListener('mousemove', e => {
            if (!dragging) return;
            panX = panSX + (e.clientX - dragSX);
            panY = panSY + (e.clientY - dragSY);
            clampPan();
            updateZoomTransform(false);
        });
        document.addEventListener('mouseup', () => {
            if (dragging) {
                dragging = false;
                cursorEl.classList.remove('grab');
                clampPan();
                updateZoomTransform(true);
            }
        });

        // Double click to zoom / reset
        canvas3d.addEventListener('dblclick', e => {
            if (imgScale > 1.05) {
                imgScale = 1; panX = 0; panY = 0;
            } else {
                const slide = canvas3d.querySelector('.slide.active');
                if (!slide) return;
                const inner = slide.querySelector('.slide-inner');
                const ir = inner.getBoundingClientRect();
                const ox = e.clientX - ir.left - ir.width / 2;
                const oy = e.clientY - ir.top - ir.height / 2;
                imgScale = 3;
                panX = ox * -2;
                panY = oy * -2;
                clampPan();
            }
            updateZoomTransform(true);
        });

        // Touch support
        let lastTD = 0, lastTC = {x:0,y:0};
        let touchStartTime = 0;
        let touchStartX = 0;

        canvas3d.addEventListener('touchstart', e => {
            if (e.touches.length === 1) {
                touchStartTime = Date.now();
                touchStartX = e.touches[0].clientX;
                if (imgScale > 1.05) {
                    dragging = true;
                    dragSX = e.touches[0].clientX; dragSY = e.touches[0].clientY;
                    panSX = panX; panSY = panY;
                }
            } else if (e.touches.length === 2) {
                dragging = false;
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                lastTD = Math.sqrt(dx*dx+dy*dy);
                lastTC = { x:(e.touches[0].clientX+e.touches[1].clientX)/2, y:(e.touches[0].clientY+e.touches[1].clientY)/2 };
            }
        }, {passive:false});

        canvas3d.addEventListener('touchmove', e => {
            e.preventDefault();
            if (e.touches.length === 1) {
                if (dragging && imgScale > 1.05) {
                    panX = panSX + (e.touches[0].clientX - dragSX);
                    panY = panSY + (e.touches[0].clientY - dragSY);
                    clampPan();
                    updateZoomTransform(false);
                }
            } else if (e.touches.length === 2) {
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const dist = Math.sqrt(dx*dx+dy*dy);
                const c = { x:(e.touches[0].clientX+e.touches[1].clientX)/2, y:(e.touches[0].clientY+e.touches[1].clientY)/2 };
                if (lastTD > 0) {
                    const f = dist / lastTD;
                    const ns = Math.max(MIN_S, Math.min(MAX_S, imgScale * f));
                    const sf = ns / imgScale;
                    panX += (c.x - lastTC.x);
                    panY += (c.y - lastTC.y);
                    imgScale = ns;
                    clampPan();
                    updateZoomTransform(false);
                }
                lastTD = dist; lastTC = c;
            }
        }, {passive:false});

        canvas3d.addEventListener('touchend', e => {
            if (e.touches.length < 2) lastTD = 0;
            if (dragging && imgScale <= 1.05) {
                // Swipe detection
                const elapsed = Date.now() - touchStartTime;
                const deltaX = e.changedTouches[0].clientX - touchStartX;
                if (elapsed < 300 && Math.abs(deltaX) > 50) {
                    if (deltaX > 0) goTo(current - 1);
                    else goTo(current + 1);
                }
            }
            dragging = false;
            clampPan(); updateZoomTransform(true);
        });

        // Zoom HUD buttons
        document.getElementById('zInBtn').addEventListener('click', () => { imgScale = Math.min(MAX_S, imgScale * 1.5); clampPan(); updateZoomTransform(); });
        document.getElementById('zOutBtn').addEventListener('click', () => { imgScale = Math.max(MIN_S, imgScale / 1.5); clampPan(); updateZoomTransform(); });
        document.getElementById('zResetBtn').addEventListener('click', () => { imgScale = 1; panX = 0; panY = 0; updateZoomTransform(); });
        document.querySelectorAll('.zoom-hud button').forEach(b => setHover(b));

        // Leave image = reset tilt
        canvas3d.addEventListener('mouseleave', resetTilt);
    }

    // ===== PARTICLES =====
    function spawnParticles() {
        for (let i = 0; i < 20; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = Math.random()*100+'vw';
            p.style.top = Math.random()*100+'vh';
            p.style.animation = `float ${10+Math.random()*15}s ease-in-out infinite, pulse ${3+Math.random()*5}s ease-in-out infinite`;
            p.style.animationDelay = Math.random()*6+'s';
            document.body.appendChild(p);
        }
    }

    // Parallax particles
    document.addEventListener('mousemove', e => {
        if (dragging) return;
        const px = (e.clientX/window.innerWidth - 0.5)*2;
        const py = (e.clientY/window.innerHeight - 0.5)*2;
        document.querySelectorAll('.particle').forEach((p,i) => {
            const s = (i%3+1)*2;
            p.style.marginLeft = px*s+'px';
            p.style.marginTop = py*s+'px';
        });
    });
    </script>
</body>
</html>
